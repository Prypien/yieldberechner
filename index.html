<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Yield Berechner</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="app-header">
    <div class="container header-content">
      <div>
        <p class="eyebrow">Yield Suite</p>
        <h1>Yield Berechner</h1>
        <p class="subtitle">Deterministische Yield-Berechnung mit Excel-Datenbasis – komplett offline.</p>
      </div>
      <div class="status-card" id="import-status-card">
        <div class="status-title">Eingaben Status</div>
        <div id="import-status" class="status-pill status-ok">Bereit – noch keine Eingaben.</div>
        <div id="import-details" class="status-details"></div>
        <div class="inline-actions">
          <button id="reload-base-data" class="btn btn-secondary" type="button">Base-Daten neu laden</button>
          <span class="muted">Funktioniert nur über lokalen Webserver (nicht file://).</span>
        </div>
      </div>
    </div>
  </header>

  <nav class="tabs" aria-label="Hauptnavigation">
    <div class="container tabs-inner">
      <button class="tab-btn active" data-tab="setup">Setup</button>
      <button class="tab-btn" data-tab="settings">Globale Einstellungen</button>
      <button class="tab-btn" data-tab="data">Daten</button>
      <button class="tab-btn" data-tab="results">Ergebnisse</button>
    </div>
  </nav>

  <main class="container">
    <section id="tab-setup" class="tab-panel active">
      <div class="panel-header">
        <h2>Setup</h2>
        <p class="muted">Lege Szenarien an und ergänze die vorhandenen Typen tabellarisch.</p>
      </div>

      <div class="panel-grid">
        <div class="card">
          <h3>Neues Szenario</h3>
          <div class="form-grid">
            <div class="field">
              <label class="label" for="scenario-id-input">ID</label>
              <input id="scenario-id-input" class="input" type="text" placeholder="S1" />
            </div>
            <div class="field">
              <label class="label" for="scenario-name-input">Name</label>
              <input id="scenario-name-input" class="input" type="text" placeholder="Baseline" />
            </div>
            <div class="field">
              <label class="label" for="scenario-start-input">Startjahr (t0)</label>
              <input id="scenario-start-input" class="input" type="number" />
            </div>
            <div class="field">
              <label class="label" for="scenario-end-input">Endjahr (tEnd)</label>
              <input id="scenario-end-input" class="input" type="number" />
            </div>
            <div class="field">
              <label class="label" for="scenario-model-input">Yield-Modell</label>
              <select id="scenario-model-input" class="input"></select>
            </div>
          </div>
          <div class="inline-actions">
            <button id="add-scenario" class="btn">Szenario hinzufügen</button>
          </div>
          <div class="table-scroll compact" id="scenario-list"></div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h3>Typen ausfüllen (Base)</h3>
          <p class="muted">Bearbeite die vorhandenen Typen tabellarisch. Keine neuen Typen/Familien/Werke.</p>
          <div class="inline-actions">
            <button id="types-save" class="btn">Änderungen speichern</button>
            <button id="types-reset" class="btn btn-secondary">Änderungen verwerfen</button>
          </div>
        </div>

        <div class="table-scroll">
          <table class="table" id="types-editor-table">
            <thead></thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="muted" id="types-editor-status"></div>
      </div>

      <div class="card">
        <h3>Szenario &amp; Berechnung</h3>
        <div class="form-grid">
          <div class="field">
            <label class="label" for="scenario-select">Szenario</label>
            <select id="scenario-select" class="input"></select>
          </div>
          <div class="field">
            <label class="label" for="scenario-name">Name</label>
            <input id="scenario-name" class="input" type="text" readonly />
          </div>
          <div class="field">
            <label class="label" for="scenario-start">Startjahr</label>
            <input id="scenario-start" class="input" type="number" />
          </div>
          <div class="field">
            <label class="label" for="scenario-end">Endjahr</label>
            <input id="scenario-end" class="input" type="number" />
          </div>
          <div class="field">
            <label class="label" for="model-select">Yield-Modell</label>
            <select id="model-select" class="input"></select>
          </div>
          <div class="field">
            <label class="label" for="plant-select">Werke</label>
            <select id="plant-select" class="input" multiple></select>
          </div>
        </div>
        <div class="inline-actions">
          <button id="run-calc" class="btn">Berechnung aktualisieren</button>
          <span id="calc-hint" class="muted">Bereit.</span>
        </div>
      </div>

      <div class="card">
        <h3>Eingaben Verlauf</h3>
        <div class="import-summary" id="import-summary">Noch keine Eingaben gespeichert.</div>
      </div>
    </section>

    <section id="tab-settings" class="tab-panel">
      <div class="panel-header">
        <h2>Globale Einstellungen</h2>
        <p class="muted">Berechnungsmodelle und Technologien werden im Tool verwaltet und sind direkt editierbar.</p>
      </div>
      <div class="settings-section">
        <h3>Berechnungsmodelle</h3>
        <p class="muted">Bearbeite die Parameter. Die Formeln kommen aus der festen Registry.</p>
        <div class="settings-grid" id="model-settings"></div>
      </div>
      <div class="settings-section">
        <h3>Technologien</h3>
        <p class="muted">Yield-Targets und Prozentwerte werden hier gepflegt – szenariospezifisch und dynamisch editierbar.</p>
        <div class="settings-grid" id="tech-settings"></div>
      </div>
    </section>

    <section id="tab-data" class="tab-panel">
      <div class="panel-header">
        <h2>Datenbasis</h2>
        <p class="muted">Übersicht der aktuell gepflegten Tabellen.</p>
      </div>
      <div class="card">
        <div class="data-overview" id="data-overview"></div>
      </div>
      <div class="card">
        <div class="card-header">
          <h3>Tabellen-Vorschau</h3>
          <div class="muted">Ausgewählte Tabelle (max. 8 Zeilen)</div>
        </div>
        <div class="table-scroll" id="table-preview"></div>
      </div>
    </section>

    <section id="tab-results" class="tab-panel">
      <div class="panel-header">
        <h2>Ergebnisse</h2>
        <p class="muted">Filtere, sortiere und inspiziere die berechneten Yields.</p>
      </div>
      <div class="filters">
        <div class="field">
          <label class="label" for="filter-search">Suche TTNR/Name</label>
          <input id="filter-search" class="input" type="search" placeholder="TTNR oder Name" />
        </div>
        <div class="field">
          <label class="label" for="filter-plant">Werk</label>
          <select id="filter-plant" class="input"></select>
        </div>
        <div class="field">
          <label class="label" for="filter-family">Family</label>
          <select id="filter-family" class="input"></select>
        </div>
        <div class="field">
          <label class="label" for="filter-year">Jahr</label>
          <select id="filter-year" class="input"></select>
        </div>
      </div>

      <div class="results-layout">
        <div class="table-scroll tall">
          <table class="table sticky" id="results-table">
            <thead>
              <tr>
                <th data-sort="year">Year</th>
                <th data-sort="ttnr">TTNR</th>
                <th>Name</th>
                <th>Plant</th>
                <th>Family</th>
                <th data-sort="fab">FAB</th>
                <th>EPI</th>
                <th>VM</th>
                <th>SAW</th>
                <th>KGD</th>
                <th>OSAT</th>
                <th>EPI_SHIP</th>
                <th data-sort="total">TOTAL</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <aside class="sidepanel" id="detail-panel" aria-live="polite">
          <div class="sidepanel-header">
            <h3>Details</h3>
            <button id="close-panel" class="btn btn-secondary" type="button">Schließen</button>
          </div>
          <div class="sidepanel-body" id="detail-body">
            <p class="muted">Wähle eine Zeile, um Details zu sehen.</p>
          </div>
          <div class="sidepanel-footer">
            <div class="sidepanel-footer-header">
              <h4>SQL Preview</h4>
              <button id="copy-sql" class="btn btn-secondary" type="button">Copy</button>
            </div>
            <pre id="sql-preview" class="sql-block"></pre>
          </div>
        </aside>
      </div>
    </section>
  </main>

  <script src="app.js"></script>
</body>
</html>
