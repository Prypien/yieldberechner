<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Yield Berechner</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="app-header">
    <div class="container header-content">
      <div>
        <p class="eyebrow">Yield Suite</p>
        <h1>Yield Berechner</h1>
        <p class="subtitle">Deterministische Yield-Berechnung mit Excel-Datenbasis – komplett offline.</p>
      </div>
      <div class="status-card" id="import-status-card">
        <div class="status-title">Eingaben Status</div>
        <div id="import-status" class="status-pill status-ok">Bereit – noch keine Eingaben.</div>
        <div id="import-details" class="status-details"></div>
        <div class="inline-actions">
          <button id="reload-base-data" class="btn btn-secondary" type="button">Base-Daten neu laden</button>
          <span class="muted">Funktioniert nur über lokalen Webserver (nicht file://).</span>
        </div>
      </div>
    </div>
  </header>

  <nav class="tabs" aria-label="Hauptnavigation">
    <div class="container tabs-inner">
      <button class="tab-btn active" data-tab="setup">Setup</button>
      <button class="tab-btn" data-tab="settings">Globale Einstellungen</button>
      <button class="tab-btn" data-tab="data">Daten</button>
      <button class="tab-btn" data-tab="results">Ergebnisse</button>
    </div>
  </nav>

  <main class="container">
    <section id="tab-setup" class="tab-panel active">
      <div class="panel-header">
        <h2>Setup</h2>
        <p class="muted">Lege deine Szenarien, Familien, Typen und Technologien direkt im Tool an.</p>
      </div>

      <div class="panel-grid">
        <div class="card">
          <h3>Neues Szenario</h3>
          <div class="form-grid">
            <div class="field">
              <label class="label" for="scenario-id-input">ID</label>
              <input id="scenario-id-input" class="input" type="text" placeholder="S1" />
            </div>
            <div class="field">
              <label class="label" for="scenario-name-input">Name</label>
              <input id="scenario-name-input" class="input" type="text" placeholder="Baseline" />
            </div>
            <div class="field">
              <label class="label" for="scenario-start-input">Startjahr (t0)</label>
              <input id="scenario-start-input" class="input" type="number" />
            </div>
            <div class="field">
              <label class="label" for="scenario-end-input">Endjahr (tEnd)</label>
              <input id="scenario-end-input" class="input" type="number" />
            </div>
            <div class="field">
              <label class="label" for="scenario-model-input">Yield-Modell</label>
              <select id="scenario-model-input" class="input"></select>
            </div>
          </div>
          <div class="inline-actions">
            <button id="add-scenario" class="btn">Szenario hinzufügen</button>
          </div>
          <div class="table-scroll compact" id="scenario-list"></div>
        </div>

        <div class="card">
          <h3>Werk &amp; Basis-Yields</h3>
          <div class="form-grid">
            <div class="field">
              <label class="label" for="plant-id-input">Werk-ID</label>
              <input id="plant-id-input" class="input" type="text" placeholder="P1" />
            </div>
            <div class="field">
              <label class="label" for="plant-name-input">Werk-Name</label>
              <input id="plant-name-input" class="input" type="text" placeholder="Werk A" />
            </div>
            <div class="field">
              <label class="label" for="plant-yield-epi">EPI</label>
              <input id="plant-yield-epi" class="input" type="number" step="0.01" placeholder="0.98" />
            </div>
            <div class="field">
              <label class="label" for="plant-yield-vm">VM</label>
              <input id="plant-yield-vm" class="input" type="number" step="0.01" placeholder="0.98" />
            </div>
            <div class="field">
              <label class="label" for="plant-yield-saw">SAW</label>
              <input id="plant-yield-saw" class="input" type="number" step="0.01" placeholder="0.98" />
            </div>
            <div class="field">
              <label class="label" for="plant-yield-kgd">KGD</label>
              <input id="plant-yield-kgd" class="input" type="number" step="0.01" placeholder="0.98" />
            </div>
            <div class="field">
              <label class="label" for="plant-yield-osat">OSAT</label>
              <input id="plant-yield-osat" class="input" type="number" step="0.01" placeholder="0.97" />
            </div>
            <div class="field">
              <label class="label" for="plant-yield-epi-ship">EPI_SHIP</label>
              <input id="plant-yield-epi-ship" class="input" type="number" step="0.01" placeholder="0.98" />
            </div>
          </div>
          <div class="inline-actions">
            <button id="add-plant" class="btn">Werk hinzufügen</button>
          </div>
          <div class="table-scroll compact" id="plant-list"></div>
        </div>
      </div>

      <div class="panel-grid">
        <div class="card">
          <h3>Familie anlegen</h3>
          <div class="form-grid">
            <div class="field">
              <label class="label" for="family-plant-select">Werk</label>
              <select id="family-plant-select" class="input"></select>
            </div>
            <div class="field">
              <label class="label" for="family-id-input">Family-ID</label>
              <input id="family-id-input" class="input" type="text" placeholder="F_CPU" />
            </div>
            <div class="field">
              <label class="label" for="family-name-input">Name</label>
              <input id="family-name-input" class="input" type="text" placeholder="CPU Family" />
            </div>
            <div class="field">
              <label class="label" for="family-density-start">Dichte Start (D0)</label>
              <input id="family-density-start" class="input" type="number" step="0.01" />
            </div>
            <div class="field">
              <label class="label" for="family-density-end">Dichte Ende (D_in)</label>
              <input id="family-density-end" class="input" type="number" step="0.01" />
            </div>
            <div class="field">
              <label class="label" for="family-t0-input">t0</label>
              <input id="family-t0-input" class="input" type="number" />
            </div>
            <div class="field">
              <label class="label" for="family-tend-input">tEnd</label>
              <input id="family-tend-input" class="input" type="number" />
            </div>
          </div>
          <div class="inline-actions">
            <button id="add-family" class="btn">Familie hinzufügen</button>
          </div>
          <div class="table-scroll compact" id="family-list"></div>
        </div>

        <div class="card">
          <h3>Typ anlegen</h3>
          <div class="form-grid">
            <div class="field">
              <label class="label" for="type-plant-select">Werk</label>
              <select id="type-plant-select" class="input"></select>
            </div>
            <div class="field">
              <label class="label" for="type-family-select">Family</label>
              <select id="type-family-select" class="input"></select>
            </div>
            <div class="field">
              <label class="label" for="type-ttnr-input">TTNR</label>
              <input id="type-ttnr-input" class="input" type="text" placeholder="CPU-001" />
            </div>
            <div class="field">
              <label class="label" for="type-name-input">Name</label>
              <input id="type-name-input" class="input" type="text" placeholder="CPU Package" />
            </div>
            <div class="field">
              <label class="label" for="type-area-input">Fläche (mm²)</label>
              <input id="type-area-input" class="input" type="number" step="0.1" />
            </div>
            <div class="field">
              <label class="label" for="type-package-input">Package</label>
              <input id="type-package-input" class="input" type="text" placeholder="BGA" />
            </div>
            <div class="field">
              <label class="label" for="type-start-year-input">Spezial-Startjahr</label>
              <input id="type-start-year-input" class="input" type="number" />
            </div>
          </div>
          <div class="inline-actions">
            <button id="add-type" class="btn">Typ hinzufügen</button>
          </div>
          <div class="table-scroll compact" id="type-list"></div>
        </div>
      </div>

      <div class="panel-grid">
        <div class="card">
          <h3>Technologie anlegen</h3>
          <div class="form-grid">
            <div class="field">
              <label class="label" for="tech-scenario-select">Szenario</label>
              <select id="tech-scenario-select" class="input"></select>
            </div>
            <div class="field">
              <label class="label" for="tech-plant-select">Werk</label>
              <select id="tech-plant-select" class="input"></select>
            </div>
            <div class="field">
              <label class="label" for="tech-id-input">Tech-ID</label>
              <input id="tech-id-input" class="input" type="text" placeholder="TECH_X" />
            </div>
            <div class="field">
              <label class="label" for="tech-name-input">Name</label>
              <input id="tech-name-input" class="input" type="text" placeholder="Copper" />
            </div>
            <div class="field">
              <label class="label" for="tech-target-select">Yield-Feld</label>
              <select id="tech-target-select" class="input"></select>
            </div>
            <div class="field">
              <label class="label" for="tech-static-input">Statisch +/-%</label>
              <input id="tech-static-input" class="input" type="number" step="0.1" />
            </div>
            <div class="field">
              <label class="label" for="tech-dynamic-input">Dynamisch?</label>
              <input id="tech-dynamic-input" class="input" type="checkbox" />
            </div>
          </div>
          <div class="inline-actions">
            <button id="add-tech" class="btn">Technologie hinzufügen</button>
          </div>
          <div class="table-scroll compact" id="tech-list"></div>
        </div>

        <div class="card">
          <h3>Typ &amp; Technologie verknüpfen</h3>
          <div class="form-grid">
            <div class="field">
              <label class="label" for="map-type-select">Typ (TTNR)</label>
              <select id="map-type-select" class="input"></select>
            </div>
            <div class="field">
              <label class="label" for="map-tech-select">Technologie</label>
              <select id="map-tech-select" class="input"></select>
            </div>
          </div>
          <div class="inline-actions">
            <button id="add-mapping" class="btn">Zuordnung hinzufügen</button>
          </div>
          <div class="table-scroll compact" id="mapping-list"></div>
        </div>
      </div>

      <div class="card">
        <h3>Szenario &amp; Berechnung</h3>
        <div class="form-grid">
          <div class="field">
            <label class="label" for="scenario-select">Szenario</label>
            <select id="scenario-select" class="input"></select>
          </div>
          <div class="field">
            <label class="label" for="scenario-name">Name</label>
            <input id="scenario-name" class="input" type="text" readonly />
          </div>
          <div class="field">
            <label class="label" for="scenario-start">Startjahr</label>
            <input id="scenario-start" class="input" type="number" />
          </div>
          <div class="field">
            <label class="label" for="scenario-end">Endjahr</label>
            <input id="scenario-end" class="input" type="number" />
          </div>
          <div class="field">
            <label class="label" for="model-select">Yield-Modell</label>
            <select id="model-select" class="input"></select>
          </div>
          <div class="field">
            <label class="label" for="plant-select">Werke</label>
            <select id="plant-select" class="input" multiple></select>
          </div>
        </div>
        <div class="inline-actions">
          <button id="run-calc" class="btn">Berechnung aktualisieren</button>
          <span id="calc-hint" class="muted">Bereit.</span>
        </div>
      </div>

      <div class="card">
        <h3>Eingaben Verlauf</h3>
        <div class="import-summary" id="import-summary">Noch keine Eingaben gespeichert.</div>
      </div>
    </section>

    <section id="tab-settings" class="tab-panel">
      <div class="panel-header">
        <h2>Globale Einstellungen</h2>
        <p class="muted">Berechnungsmodelle und Technologien werden im Tool verwaltet und sind direkt editierbar.</p>
      </div>
      <div class="settings-section">
        <h3>Berechnungsmodelle</h3>
        <p class="muted">Bearbeite die Parameter. Die Formeln kommen aus der festen Registry.</p>
        <div class="settings-grid" id="model-settings"></div>
      </div>
      <div class="settings-section">
        <h3>Technologien</h3>
        <p class="muted">Yield-Targets und Prozentwerte werden hier gepflegt – szenariospezifisch und dynamisch editierbar.</p>
        <div class="settings-grid" id="tech-settings"></div>
      </div>
    </section>

    <section id="tab-data" class="tab-panel">
      <div class="panel-header">
        <h2>Datenbasis</h2>
        <p class="muted">Übersicht der aktuell gepflegten Tabellen.</p>
      </div>
      <div class="card">
        <div class="data-overview" id="data-overview"></div>
      </div>
      <div class="card">
        <div class="card-header">
          <h3>Tabellen-Vorschau</h3>
          <div class="muted">Ausgewählte Tabelle (max. 8 Zeilen)</div>
        </div>
        <div class="table-scroll" id="table-preview"></div>
      </div>
    </section>

    <section id="tab-results" class="tab-panel">
      <div class="panel-header">
        <h2>Ergebnisse</h2>
        <p class="muted">Filtere, sortiere und inspiziere die berechneten Yields.</p>
      </div>
      <div class="filters">
        <div class="field">
          <label class="label" for="filter-search">Suche TTNR/Name</label>
          <input id="filter-search" class="input" type="search" placeholder="TTNR oder Name" />
        </div>
        <div class="field">
          <label class="label" for="filter-plant">Werk</label>
          <select id="filter-plant" class="input"></select>
        </div>
        <div class="field">
          <label class="label" for="filter-family">Family</label>
          <select id="filter-family" class="input"></select>
        </div>
        <div class="field">
          <label class="label" for="filter-year">Jahr</label>
          <select id="filter-year" class="input"></select>
        </div>
      </div>

      <div class="results-layout">
        <div class="table-scroll tall">
          <table class="table sticky" id="results-table">
            <thead>
              <tr>
                <th data-sort="year">Year</th>
                <th data-sort="ttnr">TTNR</th>
                <th>Name</th>
                <th>Plant</th>
                <th>Family</th>
                <th data-sort="fab">FAB</th>
                <th>EPI</th>
                <th>VM</th>
                <th>SAW</th>
                <th>KGD</th>
                <th>OSAT</th>
                <th>EPI_SHIP</th>
                <th data-sort="total">TOTAL</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <aside class="sidepanel" id="detail-panel" aria-live="polite">
          <div class="sidepanel-header">
            <h3>Details</h3>
            <button id="close-panel" class="btn btn-secondary" type="button">Schließen</button>
          </div>
          <div class="sidepanel-body" id="detail-body">
            <p class="muted">Wähle eine Zeile, um Details zu sehen.</p>
          </div>
          <div class="sidepanel-footer">
            <div class="sidepanel-footer-header">
              <h4>SQL Preview</h4>
              <button id="copy-sql" class="btn btn-secondary" type="button">Copy</button>
            </div>
            <pre id="sql-preview" class="sql-block"></pre>
          </div>
        </aside>
      </div>
    </section>
  </main>

  <script src="app.js"></script>
</body>
</html>
